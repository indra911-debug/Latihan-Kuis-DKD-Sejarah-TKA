<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kuis Sejarah Interaktif — 40 Soal (CBT Style)</title>
  <style>
    :root{
      --bg:#f3f6fb;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#0b6b8f;
      --success:#2e7d32;
      --danger:#c62828;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:#111827;
      padding:20px;
      display:flex;
      justify-content:center;
    }
    .wrap{
      width:100%;
      max-width:920px;
    }
    header{
      text-align:left;
      margin-bottom:14px;
    }
    h1{margin:0;font-size:20px}
    .card{
      background:var(--card);
      border-radius:12px;
      padding:18px;
      box-shadow:0 6px 22px rgba(13, 38, 63, 0.07);
    }
    #startBox{display:flex;gap:12px;align-items:center;}
    input[type="text"]{
      width:100%;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid #e6eef5;
      font-size:15px;
    }
    button.btn{
      padding:10px 14px;
      border-radius:10px;
      border:0;
      cursor:pointer;
      background:var(--accent);
      color:white;
      font-weight:600;
    }
    .meta{
      display:flex;
      justify-content:space-between;
      gap:12px;
      margin-top:12px;
    }
    .progress{
      height:10px;
      background:#eef2f7;
      border-radius:999px;
      overflow:hidden;
      flex:1;
      margin-left:8px;
    }
    .progress > i{
      display:block;height:100%;background:linear-gradient(90deg,var(--accent),#06a6d2);
      width:0%;
    }
    .question-area{margin-top:18px;text-align:left;}
    .desc{font-size:13px;color:var(--muted);margin-bottom:8px}
    .q-text{font-weight:700;margin-bottom:12px}
    .options{display:flex;flex-direction:column;gap:10px}
    .opt-btn{
      padding:12px;
      border-radius:10px;
      border:1px solid #e6eef5;
      background:#fafafb;
      cursor:pointer;
      text-align:left;
      transition:all .15s;
    }
    .opt-btn:hover{transform:translateY(-2px)}
    .opt-btn.correct{background:#e6f4ea;border-color:#b7e1c8}
    .opt-btn.wrong{background:#fff0f0;border-color:#f0b4b4}
    .opt-btn.disabled{cursor:default;opacity:0.9}
    .explain{
      margin-top:12px;
      padding:12px;
      border-radius:8px;
      background:#f8fafc;
      border:1px solid #eef3f8;
      font-size:14px;
    }
    .explain .ok{color:var(--success);font-weight:700}
    .explain .bad{color:var(--danger);font-weight:700}
    .controls{display:flex;justify-content:space-between;align-items:center;margin-top:16px;gap:12px}
    .small{font-size:13px;color:var(--muted)}
    .end-screen{text-align:center;padding:18px}
    .center{display:flex;justify-content:center}
    /* responsive */
    @media (max-width:640px){
      .meta{flex-direction:column;align-items:flex-start}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Kuis Sejarah Interaktif — 40 Soal</h1>
      <p class="small">Format: satu soal per layar. Klik jawaban untuk melihat benar/salah & penjelasan. Setelah itu bisa tekan Next.</p>
    </header>

    <div id="app" class="card">
      <!-- START / INPUT NAMA -->
      <div id="startScreen">
        <div id="startBox">
          <input id="studentName" type="text" placeholder="Masukkan nama siswa..." />
          <button id="startBtn" class="btn">Mulai Kuis</button>
        </div>
        <div class="meta">
          <div class="small">Jumlah soal: <strong>40</strong></div>
          <div style="display:flex;align-items:center"><div class="small">Kemajuan</div><div class="progress"><i id="progBar"></i></div></div>
        </div>
      </div>

      <!-- QUIZ -->
      <div id="quizScreen" style="display:none">
        <div class="question-area">
          <div class="desc" id="qDesc"></div>
          <div class="q-text" id="qText"></div>
          <div class="options" id="options"></div>

          <div id="multiSubmitWrap" style="display:none;margin-top:10px">
            <button id="submitMulti" class="btn">Kirim Jawaban</button>
          </div>

          <div id="explanation" style="display:none" class="explain"></div>
        </div>

        <div class="controls">
          <div class="small">Soal <span id="curIndex">1</span> / 40</div>
          <div style="display:flex;gap:8px">
            <button id="nextBtn" class="btn" style="display:none">Next ➜</button>
            <button id="quitBtn" class="btn" style="background:#6b7280">Batal</button>
          </div>
        </div>
      </div>

      <!-- END -->
      <div id="endScreen" style="display:none" class="end-screen">
        <!-- filled dynamically -->
      </div>
    </div>
  </div>

<script>
/* ================== CONFIG ================== */
/* Google Apps Script Web App URL (Anda yang kirimkan) */
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbz2W9Ynb9zv9jf0MpUIX0oeR-CfYZ4RNKll5uk_7bqVVzV36SxYR23VYUZuIkvWhiZ2/exec';

/* ================== STATE ================== */
let studentName = '';
let current = 0;
let score = 0;
let startedAt = null;

/* ================== QUESTIONS (40) ==================
   Format tiap objek:
   {
     id: number,
     description: string,
     question: string,
     type: 'single' | 'multi' | 'tf',
     options: [ 'A...', 'B...' ],
     correct: index (for single/tf) OR [indices] (for multi),
     explanation: string
   }
   (Semua soal & deskripsi diambil dari file PDF yang Anda unggah.)
*/
const questions = [
  {
    id:1,
    description: "Pameran Sunting: Jejak Perempuan Indonesia — konteks pameran dan peran tokoh perempuan.",
    question: "1. Bagaimana keterkaitan perjuangan perempuan pada masa lalu dengan dinamika sosial budaya perempuan Indonesia saat ini?",
    type: "single",
    options: [
      "A. Perjuangan perempuan masa lalu menjadi landasan bagi peran aktif perempuan di berbagai bidang saat ini.",
      "B. Perempuan masa kini aktif menyuarakan hak-haknya karena peran laki-laki dalam masyarakat mulai melemah.",
      "C. Semangat perjuangan tokoh perempuan dahulu mendorong berkembangnya tren perempuan mandiri masa kini.",
      "D. Perjuangan perempuan masa kini lebih modern dan tidak memiliki hubungan dengan sejarah perjuangan perempuan.",
      "E. Perjuangan perempuan masa kini lebih fokus pada kegiatan budaya dan kurang berkontribusi terhadap perubahan politik."
    ],
    correct: 0,
    explanation: "Jawaban A benar. Perjuangan perempuan masa lalu menjadi landasan dan inspirasi bagi keterlibatan perempuan di bidang sosial, politik, pendidikan, seni, dan lainnya saat ini."
  },
  {
    id:2,
    description: "Konsep berpikir sejarah — menilai pernyataan yang sesuai dengan interpretasi sejarah.",
    question: "2. Pilih pernyataan yang menunjukkan konsep berpikir sejarah (benar/salah). Mana yang benar?",
    type: "multi",
    options: [
      "Pameran Sunting tidak disusun secara kronologis.",
      "Pameran Sunting menunjukkan keberlanjutan peran perempuan dalam berbagai bidang.",
      "Peristiwa yang dialami tokoh-tokoh perempuan dalam pameran memiliki pola yang sama."
    ],
    correct: [1], // only second is correct (keberlanjutan)
    explanation: "Hanya pernyataan kedua yang sesuai. Pameran menampilkan kesinambungan peran perempuan (benar). 'Tidak disusun kronologis' tidak disebut; 'pola sama' terlalu umum dan tidak selalu benar."
  },
  {
    id:3,
    description: "Perbandingan kebijakan pertanian masa kolonial dan setelah kemerdekaan.",
    question: "3. Setelah Indonesia merdeka, kebijakan pertanian berubah. Pilih pernyataan yang benar (lebih dari satu).",
    type: "multi",
    options: [
      "Penerapan koperasi pertanian untuk menggantikan sistem tanam paksa.",
      "Perubahan kebijakan pertanian dari tanam paksa ke swasembada pangan.",
      "Pergeseran fokus kebijakan dari kepentingan kolonial ke kepentingan nasional.",
      "Penggunaan teknologi modern dalam pertanian sejak masa penjajahan Belanda.",
      "Penggunaan lahan pertanian rakyat dari masa kolonial hingga masa kemerdekaan."
    ],
    correct: [0,1,2,4], // 0,1,2,4 reasonable per teks (4 maybe ambiguous but PDF included)
    explanation: "Benar: koperasi & swasembada serta pergeseran kepentingan ke nasional. Penggunaan lahan rakyat memang berlanjut dan berubah pengaturannya. 'Penggunaan teknologi modern sejak masa penjajahan' tidak selalu benar sebagai perubahan pasca-merdeka."
  },
  {
    id:4,
    description: "Metodologi penelitian sejarah — sumber primer & arsip kolonial.",
    question: "4. Untuk meneliti dampak Undang-Undang Agraria 1870 terhadap perkebunan kopi di Pasuruan, langkah paling tepat adalah...",
    type: "single",
    options: [
      "A. Menguji sampel tanah dari lahan bekas perkebunan kopi di Pasuruan.",
      "B. Menggunakan peta kontemporer untuk menunjukkan lokasi perdagangan kopi.",
      "C. Menyebarkan survei daring kepada masyarakat Pasuruan mengenai sejarah kopi.",
      "D. Melakukan observasi langsung ke kebun kopi saat ini dan mewawancarai petani lokal.",
      "E. Membandingkan laporan kolonial dan arsip kepemilikan tanah sebelum dan sesudah 1870."
    ],
    correct: 4,
    explanation: "Jawaban E paling tepat untuk melihat dampak hukum/agraria: membandingkan laporan dan arsip kepemilikan tanah sebelum & sesudah 1870."
  },
  {
    id:5,
    description: "Sumber primer dan sekunder dalam tulisan sejarah.",
    question: "5. Manakah yang menunjukkan contoh sumber primer? (pilih lebih dari satu)",
    type: "multi",
    options: [
      "Data peningkatan jumlah pohon kopi antara 1836-1844.",
      "Hasil wawancara tahun 2020 dengan keturunan petani kopi di Pasuruan.",
      "Buku sejarah modern yang mengulas sistem tanam paksa di Jatim.",
      "Laporan Kultuur Verslag 1834 tentang jumlah petani dan pohon kopi.",
      "Naskah Undang-Undang Agraria 1870 yang diterbitkan oleh pemerintah kolonial Belanda."
    ],
    correct: [0,1,3,4],
    explanation: "Sumber primer meliputi data statistik kontemporer (0), wawancara kesaksian (1), laporan Kultuur Verslag (3), dan naskah undang-undang (4). Buku sejarah modern (2) bersifat sekunder."
  },
  {
    id:6,
    description: "Fungsi sumber sejarah — arsip, foto, kesaksian untuk karya tulis sejarah.",
    question: "6. Fungsi sumber-sumber (arsip, foto, kesaksian) terhadap penulisan sejarah: manakah tepat?",
    type: "multi",
    options: [
      "Memperkuat opini pribadi penulis sejarah.",
      "Mengurangi keragaman perspektif terhadap peristiwa sejarah.",
      "Memberikan bukti dan data yang objektif terhadap peristiwa sejarah."
    ],
    correct: [2], // only 'memberikan bukti' is tepat
    explanation: "Sumber primer memberi bukti dan data. Mereka tidak seharusnya hanya memperkuat opini pribadi dan tidak seharusnya mengurangi keragaman perspektif."
  },
  {
    id:7,
    description: "Peran jalur perdagangan dalam penyebaran agama Hindu-Buddha ke Nusantara.",
    question: "7. Apa peran jalur perdagangan bagi penyebaran agama Hindu-Buddha di Nusantara? (pilih lebih dari satu)",
    type: "multi",
    options: [
      "Jalur perdagangan memfasilitasi perpindahan pedagang, biksu, dan cendekiawan.",
      "Komoditas dagang secara langsung digunakan sebagai alat tukar untuk mengajarkan ajaran agama.",
      "Interaksi di pelabuhan memfasilitasi pertukaran budaya dan ideologi.",
      "Para pedagang mendirikan candi dan wihara di setiap pelabuhan sebagai pusat penyebaran agama.",
      "Jalur perdagangan mempermudah akses masyarakat Nusantara belajar langsung ke India lalu kembali menyebarkannya."
    ],
    correct: [0,2,4],
    explanation: "Benar: jalur perdagangan memfasilitasi perpindahan orang (0), pertukaran budaya di pelabuhan (2), dan akses belajar ke luar (4). Pernyataan 1 (komoditas langsung dipakai mengajarkan agama) dan 3 (mendirikan candi di setiap pelabuhan) terlalu mutlak."
  },
  {
    id:8,
    description: "Evaluasi pernyataan berkaitan perdagangan dan masuknya budaya Hindu-Buddha.",
    question: "8. Benar atau Salah: Pilih pernyataan yang benar sesuai teks.",
    type: "multi",
    options: [
      "Perdagangan hanya membawa keuntungan ekonomi tanpa memperkaya budaya Nusantara.",
      "Jalur rempah memainkan peran penting dalam menarik pelaut dan pedagang dari India sehingga memfasilitasi masuknya pengaruh Hindu-Buddha.",
      "Teori Brahmana dan Waisya menjelaskan bahwa agama Hindu-Buddha masuk ke Nusantara melalui jalur militer."
    ],
    correct: [1], // only second is true
    explanation: "Hanya pernyataan kedua benar. Perdagangan memperkaya budaya (jadi pernyataan 0 salah). Teori Brahmana/Waisya bukan klaim masuk lewat jalur militer secara umum (3 salah)."
  },
  {
    id:9,
    description: "Simbol kerajaan Majapahit — interpretasi ikonografi (Dewa Wisnu menunggang Garuda).",
    question: "9. Dari gambar Dewa Wisnu menunggang Garuda: manakah peran raja dalam pemerintahan Majapahit?",
    type: "single",
    options: [
      "A. Pemimpin agama",
      "B. Panglima perang",
      "C. Perwujudan dewa",
      "D. Penjaga alam semesta",
      "E. Pemimpin seluruh rakyat"
    ],
    correct: 2, // C. Perwujudan dewa (divine kingship)
    explanation: "Jawaban C tepat. Dalam ikonografi Hindu-Buddha raja sering dipandang sebagai perwujudan atau wakil dewa (devaraja)."
  },
  {
    id:10,
    description: "Dampak perkawinan antara pedagang Muslim dan bangsawan lokal pada awal Islam di Nusantara.",
    question: "10. Dampak perkawinan tersebut adalah...",
    type: "single",
    options: [
      "A. Para penguasa lokal mendapatkan keuntungan ekonomis.",
      "B. Pedagang muslim berpotensi menjadi pejabat tinggi kerajaan.",
      "C. Terjadinya konsesi dagang yang merugikan penguasa lokal.",
      "D. Banyak bangsawan lokal bermigrasi ke Timur Tengah.",
      "E. Banyak keluarga kerajaan yang masuk Islam dan melahirkan generasi muslim baru."
    ],
    correct: 4, // E
    explanation: "Jawaban E benar — perkawinan mempercepat islamisasi keluarga kerajaan dan elite lokal, melahirkan generasi muslim."
  },
  {
    id:11,
    description: "Kejayaan Samudera Pasai — tiga pilar: jaringan maritim, pemerintahan, penyebaran Islam.",
    question: "11. Benar atau Salah: Pilih pernyataan yang benar berdasarkan teks.",
    type: "multi",
    options: [
      "Letak geografis di jalur perdagangan menjadi faktor kejayaan Samudera Pasai.",
      "Peran Sultan Malik as-Saleh adalah satu-satunya faktor di balik seluruh kejayaan Samudera Pasai.",
      "Hukum syariat yang diterapkan tidak hanya terbatas pada urusan agama tetapi juga mengatur perdagangan dan sengketa."
    ],
    correct: [0,2],
    explanation: "Pernyataan 1 dan 3 benar. Pernyataan 2 salah karena kejayaan dipengaruhi banyak faktor, bukan hanya peran Sultan."
  },
  {
    id:12,
    description: "Hubungan timbal balik antara jaringan maritim dan penyebaran Islam di Samudera Pasai.",
    question: "12. Manakah pernyataan yang menunjukkan hubungan timbal balik? (lebih dari satu)",
    type: "multi",
    options: [
      "Jaringan maritim memberi jalur bagi ulama dan pedagang untuk menyebarkan Islam.",
      "Kejayaan maritim mendorong Samudera Pasai untuk mengirim ekspedisi militer guna menyebarkan Islam.",
      "Ajaran Islam memberikan kode etik yang menarik pedagang asing.",
      "Penyebaran Islam menghasilkan banyak tenaga kerja ahli maritim sehingga memperkuat jaringan perdagangan.",
      "Sultan memakai pajak perdagangan untuk membiayai pembangunan masjid di Sumatra."
    ],
    correct: [0,2,4],
    explanation: "Benar: 0 (jalur bagi ulama), 2 (etika & kepercayaan menarik pedagang), dan 4 (pajak perdagangan dipakai untuk kegiatan keagamaan). Pernyataan 1 militaristik dan 3 kurang didukung."
  },
  {
    id:13,
    description: "Dampak kolonialisme Eropa: aspek ekonomi, sosial, budaya, dan warisan infrastruktur/birokrasi.",
    question: "13. Benar atau Salah: Pernyataan terkait dampak kolonialisme. Pilih yang benar.",
    type: "multi",
    options: [
      "Kebijakan politik etis sepenuhnya berhasil meningkatkan kesejahteraan bumiputra.",
      "Pendidikan masa kolonial dirancang untuk mendukung munculnya kesadaran nasional rakyat.",
      "Struktur birokrasi modern yang diperkenalkan Belanda berdampak pada sistem administrasi masa kini."
    ],
    correct: [2], // only third is validly true as general statement
    explanation: "Hanya pernyataan 3 benar secara luas. Politik etis tidak sepenuhnya berhasil (1 salah). Pendidikan kolonial sering dibatasi dan tidak secara langsung mendorong kesadaran nasional (2 tidak sepenuhnya benar)."
  },
  {
    id:14,
    description: "Motivasi 3G bangsa Eropa (Gold, Glory, Gospel) dan tindakan di Nusantara.",
    question: "14. Berdasarkan motivasi 3G, pilih tindakan yang sesuai (lebih dari satu).",
    type: "multi",
    options: [
      "Mendirikan sekolah Eropa untuk menyebarkan nilai-nilai Barat.",
      "Memaksa penduduk lokal memeluk Katolik melalui misi zending.",
      "Menerapkan sistem pajak progresif oleh VOC untuk mendorong kesejahteraan rakyat.",
      "Mengangkat raja boneka untuk memperluas dominasi.",
      "Mendirikan benteng dagang dan markas militer di wilayah strategis."
    ],
    correct: [0,1,3,4],
    explanation: "Benar: sekolah & misi keagamaan (0,1), pengangkatan raja boneka (3), dan pembentukan benteng dagang (4). Pernyataan tentang pajak progresif oleh VOC (2) tidak sesuai; VOC malah memberlakukan kebijakan komersial dan monopolistik, bukan sistem pajak progresif untuk kesejahteraan rakyat."
  },
  {
    id:15,
    description: "Dampak kedatangan Eropa pada dinamika sosial-politik-budaya populer.",
    question: "15. Benar atau Salah: pernyataan tentang dampak kedatangan Eropa.",
    type: "multi",
    options: [
      "Penyebaran agama oleh bangsa Eropa memicu konflik budaya dengan masyarakat lokal.",
      "Dominasi politik Eropa melahirkan pemerintahan raja boneka di beberapa kerajaan.",
      "Campur tangan kolonial di bidang budaya memperkuat identitas budaya lokal secara menyeluruh."
    ],
    correct: [0,1],
    explanation: "Pernyataan 1 dan 2 benar (konflik budaya & raja boneka). Pernyataan 3 salah — campur tangan kolonial sering menekan / memodifikasi budaya lokal, bukan memperkuatnya secara menyeluruh."
  },
  {
    id:16,
    description: "Alternatif kebijakan pengganti Tanam Paksa (cultuurstelsel) agar kas negara tetap terpenuhi tanpa penderitaan rakyat.",
    question: "16. Pilih kebijakan alternatif terbaik untuk menggantikan tanam paksa:",
    type: "single",
    options: [
      "A. Mengatur kuota hasil bumi tapi memberi kebebasan jenis tanaman.",
      "B. Mewajibkan petani menanam komoditas ekspor di lahan kosong.",
      "C. Memusatkan tanam paksa di wilayah subur saja.",
      "D. Mengganti kewajiban menanam dengan kerja wajib di pabrik pemerintah.",
      "E. Memberlakukan sistem kontrak sukarela dengan insentif harga tetap bagi petani yang menanam ekspor."
    ],
    correct: 4, // E best alternative (kontrak sukarela + insentif)
    explanation: "Jawaban E paling etis & efektif: kontrak sukarela dengan insentif menghindari paksaan dan memberi kompensasi."
  },
  {
    id:17,
    description: "Politik Etis Belanda (irigasi, edukasi, transmigrasi) dan dampaknya pada kelahiran kaum terpelajar.",
    question: "17. Simpulan tepat berdasarkan politik etis:",
    type: "single",
    options: [
      "A. Politik etis gagal meningkatkan kesejahteraan rakyat.",
      "B. Politik etis menurunkan kesadaran politik bangsa Indonesia.",
      "C. Politik etis menghapus kebijakan diskriminatif kolonial.",
      "D. Politik etis melahirkan kaum terpelajar yang menjadi pelopor pergerakan nasional.",
      "E. Politik etis mempercepat kemerdekaan Indonesia melalui pendidikan."
    ],
    correct: 3, // D
    explanation: "D benar — program edukasi melahirkan golongan terpelajar yang menjadi pelopor pergerakan nasional."
  },
  {
    id:18,
    description: "Perlawanan intelektual melalui pers: Tirto Adhi Soerjo dan Medan Prijaji.",
    question: "18. Bentuk perlawanan yang tercermin dari aktivitas Tirto Adhi Soerjo?",
    type: "single",
    options: [
      "A. Pemberontakan bersenjata melawan tentara kolonial.",
      "B. Gerakan sabotase ekonomi kolonial di kota besar.",
      "C. Perlawanan diplomatik melalui perwakilan di parlemen Belanda.",
      "D. Perlawanan melalui media massa untuk membangun kesadaran nasional.",
      "E. Kerja sama dengan pengusaha bumiputra untuk melemahkan dominasi Belanda."
    ],
    correct: 3, // D
    explanation: "Jawaban D benar: penggunaan pers (surat kabar) sebagai alat perjuangan politik dan sosial."
  },
  {
    id:19,
    description: "Nilai perjuangan rakyat tercermin dari kiprah Medan Prijaji dan tokoh pers lainnya.",
    question: "19. Manakah yang mencerminkan nilai perjuangan rakyat periode kolonial? (lebih dari satu)",
    type: "multi",
    options: [
      "Pers menjadi alat penting menyuarakan keadilan sosial dan kemerdekaan.",
      "Kepatuhan terhadap penguasa kolonial merupakan bentuk perjuangan yang bijaksana.",
      "Kritik terhadap ketidakadilan sosial dihindari untuk menjaga stabilitas pemerintahan kolonial.",
      "Perlawanan dapat dilakukan melalui pendidikan dan tulisan untuk menggugah kesadaran rakyat.",
      "Rasa nasionalisme dapat tumbuh melalui penyampaian ide-ide kemerdekaan dalam media cetak."
    ],
    correct: [0,3,4],
    explanation: "Pernyataan 0,3,4 mencerminkan nilai perjuangan: pers, pendidikan, dan penyampaian ide via media cetak. Pernyataan 1-2 bertentangan."
  },
  {
    id:20,
    description: "Strategi Indische Partij (non-kooperatif) melawan kolonialisme.",
    question: "20. Strategi Indische Partij yang benar? (lebih dari satu)",
    type: "multi",
    options: [
      "Menjadikan pendidikan Barat prioritas sambil mengesampingkan isu politik.",
      "Menolak ketergantungan pada kekuatan asing dan mendorong perjuangan mandiri.",
      "Mengedepankan kerja sama dengan pemerintah Belanda untuk pengakuan politik.",
      "Membangun kesadaran rakyat lewat tulisan, pidato, dan poster.",
      "Menggalang dukungan dari organisasi lain."
    ],
    correct: [1,3,4],
    explanation: "Indische Partij menolak kooperasi, menggalang organisasi & menyebarkan kesadaran melalui media/pidato (pilihan 2,4,5 dalam teks asli)."
  },
  {
    id:21,
    description: "Tujuan berdirinya Indische Partij — sikap non-kooperatif dan persamaan hak.",
    question: "21. Benar atau Salah: tujuan Indische Partij? Pilih yang benar.",
    type: "multi",
    options: [
      "Mempersiapkan pemerintahan kolonial agar lebih demokratis.",
      "Memperkuat hubungan diplomatik dengan pemerintah Belanda.",
      "Membangun kesetaraan antara keturunan Belanda dan kaum bumiputra."
    ],
    correct: [2],
    explanation: "Tujuan Indische Partij lebih menekankan kesetaraan dan penolakan kerja sama kolonial; pilihan 3 benar. Pilihan 1-2 tidak tepat."
  },
  {
    id:22,
    description: "Kronologi masuknya Jepang & kapitulasi Belanda (Kalijati) awal 1942.",
    question: "22. Benar atau Salah: pernyataan berkaitan berakhirnya kekuasaan Belanda dan masuknya Jepang?",
    type: "multi",
    options: [
      "Letnan Jenderal Hitashi Imamura menjadi tokoh penting dalam proses penyerahan kekuasaan.",
      "Masuknya Jepang di Indonesia diawali dengan serangan ke Pearl Harbor, Hawaii.",
      "Belanda menyerah kepada Jepang melalui perjanjian Renville."
    ],
    correct: [0,1], // First two from text; third is false (Renville later with Dutch)
    explanation: "Pernyataan 1 benar (Imamura terlibat), 2 benar (awal serangan Pearl Harbor), 3 salah — Renville adalah perundingan Belanda-Indonesia pasca-Perang Dunia II."
  },
  {
    id:23,
    description: "Kebijakan ekonomi Jepang masa pendudukan: tujuan utamanya selama perang.",
    question: "23. Tujuan utama Jepang dalam kebijakan ekonomi di Indonesia pendudukan?",
    type: "single",
    options: [
      "A. Mendorong pembangunan industri ringan lokal.",
      "B. Meningkatkan ekonomi lokal tanpa kampanye militer.",
      "C. Mendukung swasembada pangan bagi rakyat Indonesia.",
      "D. Menyediakan kompensasi penuh kepada petani romusa.",
      "E. Mengeksploitasi sumber daya alam untuk kebutuhan perang Jepang."
    ],
    correct: 4,
    explanation: "Jawaban E benar — kebijakan ekonomi Jepang fokus pada eksploitasi sumber daya untuk mendukung effort perang."
  },
  {
    id:24,
    description: "Dampak pendudukan Jepang 1942–1945: kerja paksa, bahasa, struktur militer lokal.",
    question: "24. Dampak pendudukan Jepang di Indonesia? (lebih dari satu)",
    type: "multi",
    options: [
      "Petani dan buruh mengalami kesejahteraan secara merata.",
      "Rakyat banyak menjadi korban kerja paksa dan kelaparan.",
      "Penduduk diberi hak politik penuh dan bebas mengkritik pemerintah Jepang.",
      "Pemerintah Jepang mengajarkan bahasa Jepang sebagai bahasa pengantar.",
      "Pemerintah Jepang membentuk struktur militer lokal (Peta, Seinendan) yang kelak menjadi cikal bakal TNI."
    ],
    correct: [1,3,4],
    explanation: "Benar: korban kerja paksa (1), pengajaran bahasa Jepang (3), dan pembentukan struktur militer lokal (4). Pernyataan 0 dan 2 bertolak belakang: 0 salah."
  },
  {
    id:25,
    description: "Peristiwa Rengasdengklok — pemuda memaksa percepatan proklamasi (Agustus 1945).",
    question: "25. Benar atau Salah: pernyataan tentang peristiwa Rengasdengklok?",
    type: "multi",
    options: [
      "Sukarno dan Hatta dibawa ke Rengasdengklok oleh golongan muda.",
      "Peristiwa Rengasdengklok berlangsung pada 17 Agustus 1945.",
      "Tujuan pemuda membawa Sukarno & Hatta adalah agar proklamasi segera dilaksanakan."
    ],
    correct: [0,2],
    explanation: "Pernyataan 1 benar (mereka dibawa), 3 benar (tujuan mempercepat proklamasi). Pernyataan 2 salah — peristiwa itu terjadi pada 16 Agustus 1945 (proklamasi 17 Agustus)."
  },
  {
    id:26,
    description: "Penyebaran kabar proklamasi 17 Agustus 1945 — peran rakyat & media.",
    question: "26. Tindakan yang menunjukkan upaya rakyat menyebarluaskan berita proklamasi? (lebih dari satu)",
    type: "multi",
    options: [
      "Rakyat berani melawan sensor Jepang demi kemerdekaan.",
      "Jepang mendukung penuh penyiaran kabar kemerdekaan.",
      "Rakyat menunggu restu Jepang sebelum menyebarkan berita.",
      "Radio digunakan sebagai sarana penting penyebaran informasi.",
      "Kantor-kantor berita dimanfaatkan untuk mendistribusikan informasi."
    ],
    correct: [0,3,4],
    explanation: "Rakyat berani melawan sensor (0), radio & kantor berita digunakan (3,4). Jepang tidak mendukung (1 salah), dan rakyat tidak menunggu restu (2 salah)."
  },
  {
    id:27,
    description: "Pembentukan pemerintah daerah pasca-kemerdekaan — tujuan & aktor.",
    question: "27. Benar atau Salah: pernyataan tentang pembentukan pemerintah daerah awal Indonesia?",
    type: "multi",
    options: [
      "Panitia Kecil pembentukan pemerintah daerah dipimpin oleh Otto Iskandardinata.",
      "Hasil rapat PPKI pada 19 Agustus 1945 memutuskan Indonesia dibagi menjadi tujuh provinsi.",
      "Pembentukan pemerintah daerah bertujuan menggerakkan partisipasi rakyat mempertahankan kemerdekaan."
    ],
    correct: [0,2], // 1 may be true per PPKI but PDF indicated? We'll mark 1 uncertain -> keep false per source
    explanation: "Pernyataan 1 & 3 benar. (Panitia kecil dipimpin Otto; pembentukan daerah untuk mobilisasi rakyat). Pernyataan 2 tidak tepat di konteks ini."
  },
  {
    id:28,
    description: "Maklumat Pemerintah 3 November 1945 & kebijakan multipartai awal RI.",
    question: "28. Tindakan yang menunjukkan dukungan pemerintah terhadap sistem multipartai? (lebih dari satu)",
    type: "multi",
    options: [
      "Pemerintah mengeluarkan Maklumat 3 November 1945.",
      "BP-KNIP mengusulkan kebebasan mendirikan partai politik.",
      "Pembatalan keputusan pembentukan partai tunggal oleh PPKI.",
      "Pembentukan Masyumi oleh rakyat.",
      "Pembentukan PNI sebagai partai tunggal tetap dilaksanakan."
    ],
    correct: [0,1,2,3],
    explanation: "Tindakan 0-3 menunjukkan dukungan bagi multipartai. Pernyataan 5 salah karena partai tunggal dibatalkan."
  },
  {
    id:29,
    description: "Pertempuran Lima Hari di Semarang (Oktober 1945) — konteks & kontroversi.",
    question: "29. Setuju atau Tidak Setuju: pernyataan terkait Pertempuran Lima Hari di Semarang?",
    type: "multi",
    options: [
      "Pertempuran terjadi pada Oktober 1945.",
      "Penyebab utama adalah perebutan gudang senjata antara Jepang dan pasukan Indonesia.",
      "Dokter Karladi wafat karena dibunuh oleh pejuang Indonesia."
    ],
    correct: [0,1], // third is historically sensitive/false per many sources
    explanation: "Pertempuran berlangsung Oktober 1945 dan berhubungan dengan perebutan gudang senjata (0,1 benar). Pernyataan 3 tidak didukung fakta umum."
  },
  {
    id:30,
    description: "Diplomasi pasca-proklamasi — usaha mempertahankan kemerdekaan melalui jalur internasional.",
    question: "30. Bukti upaya menyelamatkan kemerdekaan melalui diplomasi? (lebih dari satu)",
    type: "multi",
    options: [
      "Membawa masalah Indonesia ke sidang PBB.",
      "Mengirim delegasi ke perundingan Linggajati.",
      "Mengadakan perundingan Renville dengan Belanda.",
      "Mengusir tentara Sekutu dari Surabaya dengan senjata.",
      "Melakukan pertempuran Medan Area melawan Belanda."
    ],
    correct: [0,1,2],
    explanation: "Upaya diplomatik tercakup pada membawa isu ke forum internasional dan perundingan Linggajati & Renville (0,1,2). Tindakan militer (3,4) adalah langkah non-diplomatik."
  },
  {
    id:31,
    description: "Masa Demokrasi Liberal (1950-1959): multipartai, pentadbiran parlemen, dampak politik.",
    question: "31. Dampak penerapan sistem multipartai pada Demokrasi Liberal? (lebih dari satu)",
    type: "multi",
    options: [
      "Mosi tidak percaya sering diajukan di parlemen.",
      "Pemerintahan berjalan stabil tanpa gejolak politik.",
      "Pemilu 1955 dapat dilaksanakan untuk memilih wakil rakyat.",
      "Presiden Sukarno menjadi pemimpin partai politik terbesar.",
      "Kabinet sering mengalami pergantian sebelum masa tugas habis."
    ],
    correct: [0,2,4],
    explanation: "Multipartai menyebabkan seringnya mosi tidak percaya, terselenggaranya Pemilu 1955, dan kabinet sering berganti. Pilihan 2&4 keliru kontekstual."
  },
  {
    id:32,
    description: "Kebijakan 'Gerakan Benteng' untuk memperkuat kewirausahaan bumiputra.",
    question: "32. Tujuan Gerakan Benteng adalah:",
    type: "single",
    options: [
      "A. Memberi lisensi impor kepada orang-orang berpotensi wirausaha.",
      "B. Membangun kewirausahaan bumiputra agar mampu membentengi perekonomian negara.",
      "C. Menciptakan kerja sama antara pengusaha bumiputra dan nonbumiputra.",
      "D. Merundingkan permasalahan finansial (Finek) dengan Belanda.",
      "E. Menanggulangi defisit akibat naiknya utang negara."
    ],
    correct: 1,
    explanation: "Jawaban B benar — Gerakan Benteng bertujuan memberdayakan pengusaha bumiputra."
  },
  {
    id:33,
    description: "Blokade ekonomi Belanda pasca-kemerdekaan: motif politik & ekonomi.",
    question: "33. Mengapa Belanda melakukan aksi blokade ekonomi pada awal kemerdekaan?",
    type: "single",
    options: [
      "A. Belanda menginginkan mata uang NICA tetap berlaku di Indonesia.",
      "B. Belanda ingin melindungi hasil perkebunan miliknya di Indonesia.",
      "C. Indonesia membatasi perdagangan dengan pemerintah Belanda.",
      "D. Kegiatan ekspor impor difokuskan untuk negara selain Belanda.",
      "E. Investor asing mengambil alih seluruh kegiatan ekonomi."
    ],
    correct: 1,
    explanation: "Jawaban B paling tepat — blokade terkait kepentingan melindungi aset/perkebunan Belanda dan menekan Pemerintah RI."
  },
  {
    id:34,
    description: "Politik Mercusuar Sukarno: simbolisme internasional lewat acara besar (Konferensi Asia-Afrika, Asian Games).",
    question: "34. Setuju/Tidak Setuju: Pernyataan berikut terkait Politik Mercusuar",
    type: "multi",
    options: [
      "Konferensi Asia-Afrika di Bandung merupakan bagian dari Politik Mercusuar.",
      "Tujuan utama Politik Mercusuar adalah membatasi peran presiden dalam pemerintahan.",
      "Asian Games di Jakarta menjadi salah satu agenda Politik Mercusuar."
    ],
    correct: [0,2],
    explanation: "Konferensi & Asian Games termasuk agenda Politik Mercusuar (0,2). Tujuan membatasi peran presiden tidak relevan (1 salah)."
  },
  {
    id:35,
    description: "Perbedaan orientasi politik luar negeri Orde Lama vs Orde Baru — fokus pembangunan & normalisasi hubungan luar.",
    question: "35. Mengapa Orde Baru bergeser ke kebijakan pragmatis dan berorientasi pembangunan?",
    type: "single",
    options: [
      "A. Untuk bergabung dengan blok Timur penuh.",
      "B. Kebutuhan bantuan ekonomi & investasi dari negara Barat.",
      "C. Tekanan internasional dari PBB.",
      "D. Dorongan negara nonblok agar Indonesia jadi pemimpin gerakan antiimperialis.",
      "E. Pengaruh komunisme makin kuat pasca-Perang Dingin."
    ],
    correct: 1,
    explanation: "Jawaban B benar — kebutuhan bantuan ekonomi dan investasi menjadi faktor utama pergeseran kebijakan luar negeri Orde Baru."
  },
  {
    id:36,
    description: "Karakter kebijakan luar negeri Orde Baru: pemulihan hubungan bilateral, peran di ASEAN, pragmatisme.",
    question: "36. Karakter kebijakan luar negeri Orde Baru? (lebih dari satu)",
    type: "multi",
    options: [
      "Mengedepankan pendekatan konfrontatif terhadap negara Barat.",
      "Memprioritaskan pemulihan hubungan diplomatik dengan negara Asia Tenggara.",
      "Memainkan peran sentral dalam pembentukan & penguatan ASEAN.",
      "Sepenuhnya mengabaikan prinsip bebas aktif demi kerja sama bilateral.",
      "Berorientasi mencari bantuan ekonomi & investasi dari negara Barat."
    ],
    correct: [1,2,4],
    explanation: "Benar: prioritas hubungan Asia Tenggara, peran di ASEAN, dan orientasi mencari investasi Barat. Orde Baru tidak konfrontatif (0 salah) dan tetap mempertahankan prinsip bebas aktif secara formal (3 salah)."
  },
  {
    id:37,
    description: "Ringkasan: pergeseran kebijakan luar negeri Orde Baru (konfrontatif -> pragmatis).",
    question: "37. Benar atau Salah: pernyataan berikut?",
    type: "multi",
    options: [
      "Indonesia masa Orde Baru memilih berpihak pada satu blok selama Perang Dingin untuk mendapat dukungan.",
      "Salah satu prioritas Orde Baru adalah menciptakan stabilitas & kerja sama di Asia Tenggara.",
      "Kebijakan luar negeri Orde Baru bergeser dari konfrontatif menjadi lebih pragmatis."
    ],
    correct: [1,2],
    explanation: "Pernyataan 2 & 3 benar. Pernyataan 1 salah karena Orde Baru cenderung bersikap bebas-aktif & pragmatis, bukan memilih satu blok penuh."
  },
  {
    id:38,
    description: "Krisis 1998 & peran mahasiswa sebagai penggerak reformasi yang menuntut Soeharto mundur.",
    question: "38. Benar atau Salah: peran pelajar & mahasiswa dalam proses lahirnya reformasi?",
    type: "multi",
    options: [
      "Mahasiswa mengambil alih sistem pemerintahan demokratis.",
      "Mahasiswa menjadi penggerak dalam mendorong perubahan sistem politik.",
      "Gerakan mahasiswa 1998 merupakan tonggak perubahan periode pemerintahan Indonesia."
    ],
    correct: [1,2],
    explanation: "Pernyataan 2 & 3 benar: mahasiswa penggerak besar & 1998 menjadi tonggak reformasi. Pernyataan 1 berlebihan (mereka mempengaruhi tapi tidak 'mengambil alih sistem pemerintahan')."
  },
  {
    id:39,
    description: "Langkah awal pemerintahan B.J. Habibie untuk perbaikan ekonomi pasca-Orde Baru.",
    question: "39. Langkah-langkah yang diambil Habibie untuk memperbaiki ekonomi? (lebih dari satu)",
    type: "multi",
    options: [
      "Memperbaiki kinerja ekspor.",
      "Melakukan privatisasi BUMN.",
      "Melakukan reformasi perbankan.",
      "Memberikan bantuan langsung tunai.",
      "Menetapkan undang-undang antimonopoli."
    ],
    correct: [0,2],
    explanation: "Langkah penting termasuk perbaikan ekspor dan reformasi perbankan. Privatisasi serta program bantuan lain ada dalam konteks masa berbeda; undang-undang antimonopoli bukan langkah utama awal Habibie."
  },
  {
    id:40,
    description: "Kebijakan BBM era Joko Widodo — alasan penyesuaian subsidi dan anggaran.",
    question: "40. Apa tujuan pemerintah menaikkan harga BBM?",
    type: "single",
    options: [
      "A. Menghindari pemanasan global.",
      "B. Mencanangkan program go green.",
      "C. Menyesuaikan harga minyak dunia.",
      "D. Menekan jumlah kendaraan bermotor.",
      "E. Mengalihkan subsidi pada sektor produktif."
    ],
    correct: 4, // E
    explanation: "Tujuan kebijakan seringkali untuk mengalihkan subsidi kepada sektor produktif dan memperbaiki alokasi anggaran (E). Penyesuaian terhadap harga dunia juga relevan, namun dalam konteks soal PDF jawaban E diberikan."
  }
]; // end questions

/* ============== UI HELPERS =============== */
const startBtn = document.getElementById('startBtn');
const studentInput = document.getElementById('studentName');
const startScreen = document.getElementById('startScreen');
const quizScreen = document.getElementById('quizScreen');
const endScreen = document.getElementById('endScreen');
const qDesc = document.getElementById('qDesc');
const qText = document.getElementById('qText');
const optionsWrap = document.getElementById('options');
const explanationBox = document.getElementById('explanation');
const nextBtn = document.getElementById('nextBtn');
const submitMulti = document.getElementById('submitMulti');
const multiSubmitWrap = document.getElementById('multiSubmitWrap');
const curIndex = document.getElementById('curIndex');
const progBar = document.getElementById('progBar');
const quitBtn = document.getElementById('quitBtn');

/* ============ START QUIZ ================ */
startBtn.addEventListener('click', () => {
  const name = studentInput.value.trim();
  if(!name){
    alert('Masukkan nama siswa terlebih dahulu.');
    studentInput.focus();
    return;
  }
  studentName = name;
  startScreen.style.display = 'none';
  quizScreen.style.display = 'block';
  startedAt = new Date();
  current = 0;
  score = 0;
  loadQuestion();
});

quitBtn.addEventListener('click', () => {
  if(confirm('Batalkan kuis dan kembali ke awal?')) location.reload();
});

/* ============ LOAD QUESTION ============== */
function loadQuestion(){
  const q = questions[current];
  // update progress
  curIndex.innerText = (current+1);
  const percent = Math.round(((current)/questions.length) * 100);
  progBar.style.width = percent + '%';

  // reset
  explanationBox.style.display = 'none';
  explanationBox.innerHTML = '';
  nextBtn.style.display = 'none';
  multiSubmitWrap.style.display = 'none';
  optionsWrap.innerHTML = '';

  qDesc.innerText = q.description || '';
  qText.innerText = q.question;

  if(q.type === 'single' || q.type === 'tf'){
    // render as clickable buttons
    q.options.forEach((opt, idx) => {
      const b = document.createElement('button');
      b.className = 'opt-btn';
      b.innerText = opt;
      b.dataset.idx = idx;
      b.addEventListener('click', () => handleSingleChoice(idx, b));
      optionsWrap.appendChild(b);
    });
  } else if(q.type === 'multi'){
    // render checkboxes + show submit
    q.options.forEach((opt, idx) => {
      const wrapper = document.createElement('label');
      wrapper.style.display = 'flex';
      wrapper.style.alignItems = 'center';
      wrapper.style.gap = '10px';
      wrapper.style.padding = '8px';
      wrapper.style.borderRadius = '8px';
      wrapper.style.border = '1px solid #eef3f8';
      wrapper.style.cursor = 'pointer';
      wrapper.style.background = '#fff';
      const cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.dataset.idx = idx;
      cb.style.width = '18px';
      cb.style.height = '18px';
      const span = document.createElement('div');
      span.innerText = opt;
      wrapper.appendChild(cb);
      wrapper.appendChild(span);
      optionsWrap.appendChild(wrapper);
    });
    multiSubmitWrap.style.display = 'block';
  }
}

/* ============ HANDLERS ================ */
function handleSingleChoice(selectedIdx, btnElem){
  // disable all options
  const btns = optionsWrap.querySelectorAll('.opt-btn');
  btns.forEach(b => {
    b.classList.add('disabled');
    b.disabled = true;
  });

  const q = questions[current];
  // mark correct and wrong
  const correctIdx = q.correct;
  btns.forEach(b => {
    const i = Number(b.dataset.idx);
    if(i === correctIdx) b.classList.add('correct');
    if(i === selectedIdx && i !== correctIdx) b.classList.add('wrong');
  });

  // award score
  if(selectedIdx === correctIdx) {
    score += 1;
    explanationBox.innerHTML = `<div class="ok">Benar ✔</div><div style="margin-top:8px">${q.explanation}</div>`;
  } else {
    explanationBox.innerHTML = `<div class="bad">Salah ✖</div><div style="margin-top:8px">${q.explanation}</div>`;
  }
  explanationBox.style.display = 'block';
  nextBtn.style.display = 'inline-block';
  // scroll explanation into view (mobile)
  explanationBox.scrollIntoView({behavior:'smooth'});
}

submitMulti.addEventListener('click', () => {
  const q = questions[current];
  const checks = optionsWrap.querySelectorAll('input[type="checkbox"]');
  const selected = [];
  checks.forEach(cb => {
    if(cb.checked) selected.push(Number(cb.dataset.idx));
  });
  if(selected.length === 0){
    alert('Pilih minimal satu opsi sebelum kirim.');
    return;
  }
  // disable further interaction
  checks.forEach(cb => cb.disabled = true);

  const correctArr = Array.isArray(q.correct) ? q.correct.slice().sort((a,b)=>a-b) : [q.correct];
  const selSorted = selected.slice().sort((a,b)=>a-b);

  // check if selected exactly matches correct array
  const isExact = (selSorted.length === correctArr.length) && selSorted.every((v,i)=>v===correctArr[i]);

  // visually mark items
  const wrappers = optionsWrap.querySelectorAll('label');
  wrappers.forEach((w, idx) => {
    const cb = w.querySelector('input');
    if(correctArr.includes(idx)){
      w.style.background = '#e6f4ea';
      w.style.borderColor = '#b7e1c8';
    }
    if(cb.checked && !correctArr.includes(idx)){
      w.style.background = '#fff0f0';
      w.style.borderColor = '#f0b4b4';
    }
  });

  if(isExact){
    score += 1;
    explanationBox.innerHTML = `<div class="ok">Benar ✔ (Kriteria lengkap)</div><div style="margin-top:8px">${q.explanation}</div>`;
  } else {
    explanationBox.innerHTML = `<div class="bad">Jawaban belum lengkap atau ada jawaban salah ✖</div><div style="margin-top:8px">${q.explanation}</div>`;
  }
  explanationBox.style.display = 'block';
  nextBtn.style.display = 'inline-block';
  explanationBox.scrollIntoView({behavior:'smooth'});
});

/* ============ NEXT / FINISH ============== */
nextBtn.addEventListener('click', () => {
  current++;
  if(current < questions.length){
    loadQuestion();
    // hide Next until answered
    nextBtn.style.display = 'none';
  } else {
    finishQuiz();
  }
});

function finishQuiz(){
  quizScreen.style.display = 'none';
  endScreen.style.display = 'block';
  const durationMs = new Date() - startedAt;
  const minutes = Math.floor(durationMs/60000);
  const seconds = Math.floor((durationMs%60000)/1000);
  const total = questions.length;
  const percent = Math.round((score/total)*100);

  progBar.style.width = '100%';

  endScreen.innerHTML = `
    <div class="card" style="padding:20px">
      <h2>Hasil Kuis</h2>
      <p>Nama: <strong>${escapeHtml(studentName)}</strong></p>
      <p>Skor: <strong>${score}</strong> dari <strong>${total}</strong> (${percent}%)</p>
      <p>Waktu: <strong>${minutes} menit ${seconds} detik</strong></p>
      <div style="margin-top:12px" class="center">
        <button id="downloadBtn" class="btn">Simpan & Kirim ke Google Sheet</button>
        <button id="restartBtn" class="btn" style="background:#6b7280;margin-left:8px">Ulangi</button>
      </div>
      <div style="margin-top:10px" class="small">Catatan: klik "Simpan & Kirim" untuk mengirim hasil ke Google Sheet.</div>
    </div>
  `;

  document.getElementById('downloadBtn').addEventListener('click', sendResult);
  document.getElementById('restartBtn').addEventListener('click', ()=> location.reload());
}

/* ============ SEND RESULT TO GOOGLE SHEET ============== */
async function sendResult(){
  const total = questions.length;
  const percent = Math.round((score/total)*100);
  const payload = {
    name: studentName,
    score: score,
    total: total,
    percent: percent,
    datetime: (new Date()).toISOString()
  };

  // feedback to user
  try {
    const btn = event.target;
    btn.disabled = true;
    btn.innerText = 'Mengirim...';

    const res = await fetch(WEB_APP_URL, {
      method: 'POST',
      mode: 'cors',
      headers: {
        'Content-Type':'application/json'
      },
      body: JSON.stringify(payload)
    });

    if(res.ok){
      btn.innerText = 'Berhasil Terkirim ✅';
      alert('Hasil berhasil dikirim ke Google Sheet.');
    } else {
      btn.innerText = 'Gagal Terkirim (Klik lagi)';
      const text = await res.text();
      console.error('Response not ok:', res.status, text);
      alert('Gagal mengirim. Periksa konfigurasi Web App. (lihat console)');
      btn.disabled = false;
    }
  } catch(err){
    console.error(err);
    alert('Terjadi kesalahan saat mengirim: ' + err.message + '\nPeriksa konfigurasi Web App & koneksi.');
    const btn2 = document.querySelector('#downloadBtn');
    if(btn2){ btn2.disabled = false; btn2.innerText = 'Simpan & Kirim ke Google Sheet'; }
  }
}

/* ============ UTIL ============== */
function escapeHtml(unsafe) {
  return unsafe.replace(/[&<"'>]/g, function(m) {
    return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]);
  });
}

/* load first question only when started by user */
</script>
</body>
</html>
